Source URL: https://developers.google.com/people/quickstart/nodejs?hl=ko

이 페이지는 Cloud Translation API [https://cloud.google.com/translate/?hl=ko]를 통해 번역되었습니다.
Switch to English
홈 [https://developers.google.com/?hl=ko]
제품 [https://developers.google.com/products?hl=ko]
Google Workspace [https://developers.google.com/workspace?hl=ko]
People API [https://developers.google.com/people?hl=ko]
도움이 되었나요?
Node.js 빠른 시작
bookmark_border
이 페이지의 내용
목표 [https://developers.google.com/people/quickstart/nodejs?hl=ko#objectives]
기본 요건 [https://developers.google.com/people/quickstart/nodejs?hl=ko#prerequisites]
환경 설정 [https://developers.google.com/people/quickstart/nodejs?hl=ko#set-up-environment]
API 사용 설정 [https://developers.google.com/people/quickstart/nodejs?hl=ko#enable_the_api]
OAuth 동의 화면 구성 [https://developers.google.com/people/quickstart/nodejs?hl=ko#configure_the_oauth_consent_screen]
데스크톱 애플리케이션의 사용자 인증 정보 승인 [https://developers.google.com/people/quickstart/nodejs?hl=ko#authorize_credentials_for_a_desktop_application]
클라이언트 라이브러리 설치 [https://developers.google.com/people/quickstart/nodejs?hl=ko#install_the_client_library]
샘플 설정 [https://developers.google.com/people/quickstart/nodejs?hl=ko#set_up_the_sample]
People API에 요청을 보내는 Node.js 명령줄 애플리케이션을 만듭니다.
빠른 시작에서는 Google Workspace API를 호출하는 앱을 설정하고 실행하는 방법을 설명합니다. 이 빠른 시작에서는 테스트 환경에 적합한 간소화된 인증 방식을 사용합니다. 프로덕션 환경의 경우 앱에 적합한 액세스 사용자 인증 정보 선택 [https://developers.google.com/workspace/guides/create-credentials?hl=ko#choose_the_access_credential_that_is_right_for_you] 전에 인증 및 승인 [https://developers.google.com/workspace/guides/auth-overview?hl=ko]에 대해 알아보는 것이 좋습니다.
이 빠른 시작에서는 Google Workspace의 권장 API 클라이언트 라이브러리를 사용하여 인증 및 승인 흐름의 일부 세부정보를 처리합니다.
목표
환경을 설정합니다.
클라이언트 라이브러리를 설치합니다.
샘플을 설정합니다.
샘플을 실행합니다.
기본 요건
이 빠른 시작을 실행하려면 다음 기본 요건이 필요합니다.
Node.js 및 npm [https://docs.npmjs.com/getting-started/installing-node#1-install-nodejs--npm]이 설치되어 있어야 합니다.
Google Cloud 프로젝트 [https://developers.google.com/workspace/guides/create-project?hl=ko].
API 액세스가 사용 설정 [https://support.google.com/a/answer/60757?hl=ko]된 Google Workspace 도메인
관리자 권한이 있는 해당 도메인의 Google 계정
환경 설정
이 빠른 시작을 완료하려면 환경을 설정하세요.
API 사용 설정
Google API를 사용하려면 먼저 Google Cloud 프로젝트에서 사용 설정해야 합니다. 단일 Google Cloud 프로젝트에서 하나 이상의 API를 사용 설정할 수 있습니다.
Google Cloud 콘솔에서 People API를 사용 설정합니다.
API 사용 설정 [https://console.cloud.google.com/flows/enableapi?apiid=people.googleapis.com&hl=ko]
OAuth 동의 화면 구성
새 Google Cloud 프로젝트를 사용하여 이 빠른 시작을 완료하는 경우 OAuth 동의 화면을 구성합니다. Cloud 프로젝트에서 이 단계를 이미 완료했다면 다음 섹션으로 건너뜁니다.
Google Cloud 콘솔에서 메뉴 menu > > 브랜딩으로 이동합니다.
브랜딩으로 이동 [https://console.cloud.google.com/auth/branding?hl=ko]
을 이미 구성한 경우 브랜딩 [https://console.cloud.google.com/auth/branding?hl=ko], 잠재고객 [https://console.cloud.google.com/auth/audience?hl=ko], 데이터 액세스 [https://console.cloud.google.com/auth/scopes?hl=ko]에서 다음 OAuth 동의 화면 설정을 구성할 수 있습니다. 아직 구성되지 않음이라는 메시지가 표시되면 시작하기를 클릭합니다.
앱 정보의 앱 이름에 앱 이름을 입력합니다.
사용자 지원 이메일에서 사용자가 동의에 대해 문의할 수 있는 지원 이메일 주소를 선택합니다.
다음을 클릭합니다.
시청자층에서 내부를 선택합니다.
다음을 클릭합니다.
연락처 정보에서 프로젝트 변경사항에 대한 알림을 받을 수 있는 이메일 주소를 입력합니다.
다음을 클릭합니다.
완료에서 Google API 서비스 사용자 데이터 정책 [https://developers.google.com/terms/api-services-user-data-policy?hl=ko]을 검토하고 동의하는 경우 Google API 서비스: 사용자 데이터 정책에 동의합니다를 선택합니다.
계속을 클릭합니다.
만들기를 클릭합니다.
지금은 범위를 추가하지 않아도 됩니다. 향후 Google Workspace 조직 외부에서 사용할 앱을 만들 때는 사용자 유형을 외부로 변경해야 합니다. 그런 다음 앱에 필요한 승인 범위를 추가합니다. 자세한 내용은 OAuth 동의 구성 [https://developers.google.com/workspace/guides/configure-oauth-consent?hl=ko] 가이드를 참고하세요.
데스크톱 애플리케이션의 사용자 인증 정보 승인
최종 사용자를 인증하고 앱에서 사용자 데이터에 액세스하려면 OAuth 2.0 클라이언트 ID를 하나 이상 만들어야 합니다. 클라이언트 ID는 Google OAuth 서버에서 단일 앱을 식별하는 데 사용됩니다. 앱이 여러 플랫폼에서 실행되는 경우 플랫폼별로 별도의 클라이언트 ID를 만들어야 합니다.
주의: 이 빠른 시작은 로컬에서 브라우저에 액세스하여 실행해야 합니다. Cloud Shell과 같은 원격 터미널에서 실행하거나 SSH를 통해 실행하면 작동하지 않습니다.
Google Cloud 콘솔에서 메뉴 menu > > 클라이언트로 이동합니다.
클라이언트로 이동 [https://console.cloud.google.com/auth/clients?hl=ko]
클라이언트 만들기를 클릭합니다.
애플리케이션 유형 > 데스크톱 앱을 클릭합니다.
이름 필드에 사용자 인증 정보의 이름을 입력합니다. 이 이름은 Google Cloud 콘솔에만 표시됩니다.
만들기를 클릭합니다.
새로 만든 사용자 인증 정보가 'OAuth 2.0 클라이언트 ID' 아래에 표시됩니다.
다운로드한 JSON 파일을 credentials.json로 저장하고 파일을 작업 디렉터리로 이동합니다.
클라이언트 라이브러리 설치
npm을 사용하여 라이브러리를 설치합니다.
npm install googleapis@105 @google-cloud/local-auth@2.1.0 --save
샘플 설정
작업 디렉터리에 index.js이라는 파일을 만듭니다.
파일에 다음 코드를 붙여넣습니다.
people/quickstart/index.js
GitHub에서 보기 [https://github.com/googleworkspace/node-samples/blob/main/people/quickstart/index.js]
const fs = require('fs').promises;
const path = require('path');
const process = require('process');
const {authenticate} = require('@google-cloud/local-auth');
const {google} = require('googleapis');

// If modifying these scopes, delete token.json.
const SCOPES = ['https://www.googleapis.com/auth/contacts.readonly'];
// The file token.json stores the user's access and refresh tokens, and is
// created automatically when the authorization flow completes for the first
// time.
const TOKEN_PATH = path.join(process.cwd(), 'token.json');
const CREDENTIALS_PATH = path.join(process.cwd(), 'credentials.json');

/**
 * Reads previously authorized credentials from the save file.
 *
 * @return {Promise<OAuth2Client|null>}
 */
async function loadSavedCredentialsIfExist() {
  try {
    const content = await fs.readFile(TOKEN_PATH);
    const credentials = JSON.parse(content);
    return google.auth.fromJSON(credentials);
  } catch (err) {
    return null;
  }
}

/**
 * Serializes credentials to a file compatible with GoogleAuth.fromJSON.
 *
 * @param {OAuth2Client} client
 * @return {Promise<void>}
 */
async function saveCredentials(client) {
  const content = await fs.readFile(CREDENTIALS_PATH);
  const keys = JSON.parse(content);
  const key = keys.installed || keys.web;
  const payload = JSON.stringify({
    type: 'authorized_user',
    client_id: key.client_id,
    client_secret: key.client_secret,
    refresh_token: client.credentials.refresh_token,
  });
  await fs.writeFile(TOKEN_PATH, payload);
}

/**
 * Load or request or authorization to call APIs.
 *
 */
async function authorize() {
  let client = await loadSavedCredentialsIfExist();
  if (client) {
    return client;
  }
  client = await authenticate({
    scopes: SCOPES,
    keyfilePath: CREDENTIALS_PATH,
  });
  if (client.credentials) {
    await saveCredentials(client);
  }
  return client;
}

/**
 * Print the display name if available for 10 connections.
 *
 * @param {google.auth.OAuth2} auth An authorized OAuth2 client.
 */
async function listConnectionNames(auth) {
  const service = google.people({version: 'v1', auth});
  const res = await service.people.connections.list({
    resourceName: 'people/me',
    pageSize: 10,
    personFields: 'names,emailAddresses',
  });
  const connections = res.data.connections;
  if (!connections || connections.length === 0) {
    console.log('No connections found.');
    return;
  }
  console.log('Connections:');
  connections.forEach((person) => {
    if (person.names && person.names.length > 0) {
      console.log(person.names[0].displayName);
    } else {
      console.log('No display name found for connection.');
    }
  });
}

authorize().then(listConnectionNames).catch(console.error);
샘플 실행
작업 디렉터리에서 샘플을 실행합니다.
node .
샘플을 처음 실행하면 액세스 권한을 승인하라는 메시지가 표시됩니다.
아직 Google 계정에 로그인하지 않았다면 메시지가 표시될 때 로그인합니다. 여러 계정에 로그인되어 있는 경우 승인에 사용할 계정을 하나 선택합니다.
수락을 클릭합니다.
Nodejs 애플리케이션이 실행되고 People API를 호출합니다.
승인 정보는 파일 시스템에 저장되므로 다음에 샘플 코드를 실행할 때는 승인 메시지가 표시되지 않습니다.
다음 단계
인증 및 승인 문제 해결 [https://developers.google.com/people/v1/troubleshoot-authentication-authorization?hl=ko]
People API 참조 문서 [https://developers.google.com/people/api?hl=ko]
GitHub의 google-api-nodejs-client 섹션 [https://github.com/google/google-api-nodejs-client/#google-apis-nodejs-client]
도움이 되었나요?